#:schema https://raw.githubusercontent.com/YunoHost/apps/master/schemas/manifest.v2.schema.json

packaging_format = 2

id = "guacamole"
name = "Guacamole"
description.en = "Clientless remote desktop gateway. It supports standard protocols like VNC, RDP, and SSH"
description.fr = "Service de bureau à distance sans client. Fonctionne avec des protocoles standard comme VNC, RDP, et SSH"

version = "1.5.4~ynh2"

maintainers = ["Jules Bertholet"]

[upstream]
license = "Apache-2.0"
website = "https://guacamole.apache.org/"
admindoc = "https://guacamole.apache.org/doc/gug/"
code = "https://github.com/apache/guacamole-server"

[integration]
yunohost = ">= 11.2"
architectures = "all"
multi_instance = true

ldap = true

sso = false

disk = "50M"
ram.build = "50M"
ram.runtime = "50M"

[install]
    [install.domain]
    type = "domain"

    [install.path]
    type = "path"
    default = "/guacamole"

    [install.admin]
    type = "user"

    [install.init_main_permission]
    help.en = "Not recommended"
    help.fr = "Pas reccomandé"
    type = "group"
    default = "all_users"

[resources]
    [resources.sources]
    [resources.sources.server]
    url = "https://downloads.apache.org/guacamole/1.5.5/source/guacamole-server-1.5.5.tar.gz"
    sha256 = "67499611c2e22d9c933763adc5408e716a4bfd08a3eb8a5ba2fc6f8f70868f6b"

    [resources.sources.client]
    url = "https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-1.5.5.war"
    sha256 = "4267307f3600663723f24af92d596e99c8359425315135052a42d451f9529200"
    format = "zip"
    extract = false
    rename = "guacamole.war"

    [resources.sources.auth-header]
    url = "https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-auth-header-1.5.5.tar.gz"
    sha256 = "a39ca9563be6d31b4dc1251c76a62baeb2a9d4930b3055e342bb9ce80e526a78"

    [resources.sources.auth-ldap]
    url = "https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-auth-ldap-1.5.5.tar.gz"
    sha256 = "01d3cd74da5de9da9cc73a788ab2938dd44f5cbe42ad90eebb4bee07f246dfa3"

    [resources.sources.auth-jdbc]
    url = "https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-auth-jdbc-1.5.5.tar.gz"
    sha256 = "80cca0a02076babad0dc7c76b60daa896f3d9bf10be82708f425fd42ce411393"

    [resources.sources.mariadb-java-client]
    url = "https://downloads.mariadb.com/Connectors/java/connector-java-2.7.4/mariadb-java-client-2.7.4.jar"
    sha256 = "f06577b19e89b33028b96cd4f031248e761de7ebc712f4ef535e268df76edb2a"
    format = "whatever"
    extract = false
    rename = "mariadb-java-client.jar"

    [resources.sources.tomcat9_deb]
    url = "https://ftp.debian.org/debian/pool/main/t/tomcat9/tomcat9_9.0.43-2~deb11u9_all.deb"
    sha256 = "e016d55fd13bb51906106ede43fd970001f9b23db89628ddcbcca11e10a6068f"
    format = "whatever"
    extract = false
    rename = "tomcat9.deb"

    [resources.sources.tomcat10_deb]
    url = "https://ftp.debian.org/debian/pool/main/t/tomcat10/tomcat10_10.1.6-1+deb12u2_all.deb"
    sha256 = "69cf85b0e9934314677a881a994a694c0f2fcf27065d520ef99305e53795f7f8"
    format = "whatever"
    extract = false
    rename = "tomcat10.deb"

    [resources.ports]
    main.default = 8080
    guacd.default = 4822

    [resources.system_user]

    [resources.install_dir]

    [resources.permissions]
    main.url = "/"

    [resources.apt]
    packages = [
        "mariadb-server",
        "acl",
        "build-essential",
        "libcairo2",
        "libjpeg62-turbo-dev",
        "libpng-dev",
        "libtool-bin",
        "libossp-uuid-dev",
        "libavcodec-dev",
        "libavformat-dev",
        "libavutil-dev",
        "libswscale-dev",
        "freerdp2-dev",
        "libpango1.0-dev",
        "libssh2-1-dev",
        "libtelnet-dev",
        "libvncserver-dev",
        "libwebsockets-dev",
        "libpulse-dev",
        "libssl-dev",
        "libvorbis-dev",
        "libwebp-dev",
        "tomcat9\\|tomcat10",
    ]

    [resources.database]
    type = "mysql"
